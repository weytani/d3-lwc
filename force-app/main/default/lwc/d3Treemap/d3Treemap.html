<template>
    <div class="slds-card">
        <!-- Loading State -->
        <template lwc:if={isLoading}>
            <div class="slds-align_absolute-center" style="height: 200px;">
                <lightning-spinner alternative-text="Loading chart..." size="medium"></lightning-spinner>
            </div>
        </template>

        <!-- Error State -->
        <template lwc:elseif={hasError}>
            <div class="slds-align_absolute-center slds-text-color_error" style="height: 200px; padding: 1rem;">
                <div class="slds-text-align_center">
                    <lightning-icon icon-name="utility:error" alternative-text="Error" size="large" variant="error"></lightning-icon>
                    <p class="slds-m-top_small">{error}</p>
                </div>
            </div>
        </template>

        <!-- Chart Container (has data) -->
        <template lwc:elseif={hasData}>
            <!-- Truncation Warning -->
            <template lwc:if={truncatedWarning}>
                <div class="slds-notify slds-notify_alert slds-alert_warning slds-m-bottom_x-small" role="alert">
                    <span class="slds-assistive-text">warning</span>
                    <span class="slds-icon_container slds-m-right_x-small">
                        <lightning-icon icon-name="utility:warning" size="x-small" variant="warning"></lightning-icon>
                    </span>
                    <h2>{truncatedWarning}</h2>
                </div>
            </template>

            <!-- Breadcrumb Navigation (when zoomed) -->
            <template lwc:if={hasBreadcrumbs}>
                <nav class="slds-p-horizontal_medium slds-p-vertical_x-small slds-border_bottom" role="navigation" aria-label="Breadcrumbs">
                    <ol class="slds-breadcrumb slds-list_horizontal slds-wrap">
                        <template for:each={breadcrumbItems} for:item="crumb">
                            <li class="slds-breadcrumb__item" key={crumb.key}>
                                <template lwc:if={crumb.isLast}>
                                    <span class="slds-text-color_weak">{crumb.name}</span>
                                </template>
                                <template lwc:else>
                                    <a 
                                        href="javascript:void(0);" 
                                        data-index={crumb.key}
                                        onclick={handleBreadcrumbClick}
                                        class="slds-text-link"
                                    >{crumb.name}</a>
                                    <span class="slds-m-horizontal_xx-small">/</span>
                                </template>
                            </li>
                        </template>
                        <li class="slds-breadcrumb__item">
                            <button 
                                class="slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small slds-m-left_x-small"
                                title="Reset zoom"
                                onclick={handleResetZoom}
                            >
                                <lightning-icon icon-name="utility:home" size="xx-small" alternative-text="Reset"></lightning-icon>
                            </button>
                        </li>
                    </ol>
                </nav>
            </template>

            <!-- Chart -->
            <div class="chart-container" style={containerStyle}></div>
        </template>

        <!-- No Data State -->
        <template lwc:else>
            <div class="slds-align_absolute-center slds-text-color_weak" style="height: 200px;">
                <div class="slds-text-align_center">
                    <lightning-icon icon-name="utility:chart" alternative-text="No data" size="large"></lightning-icon>
                    <p class="slds-m-top_small">No data available</p>
                </div>
            </div>
        </template>
    </div>
</template>
